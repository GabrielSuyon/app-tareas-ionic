<ion-content color="light"  >
  <app-header color="light" [centerTitle]=true [isModal]=true   [title]="task ? 'Editar Tarea' : 'Nueva Tarea'"
 ></app-header>

  <app-custom-input 
          [control]="form.controls.title" 
          type="text" 
          label="Titulo" 
          icon="person-outline">
        </app-custom-input>
        <div class="validators" *ngIf="form.controls.title.errors && form.controls.title.touched">
          <div *ngIf="form.controls.title.errors?.['required']">Ingresa el título de la tarea</div>
          <div *ngIf="form.controls.title.errors?.['minLength']">El título debe tener al menos 4 caracteres</div>
        </div>

          <app-custom-input 
          [control]="form.controls.description" 
          type="textarea" 
          label="Descripción" 
          icon="document-text-outline">
        </app-custom-input>
        <div class="validators" *ngIf="form.controls.description.errors && form.controls.description.touched">
          <div *ngIf="form.controls.description.errors?.['required']">Ingresa la descripción de la tarea</div>
          <div *ngIf="form.controls.description.errors?.['minLength']">La descripción debe tener al menos 4 caracteres</div>
        </div>

        <ion-item class="item-header" lines="none" >
          <ion-label>Actividades</ion-label>
          <span slot="end" *ngIf="form.value.items.length" >  
            Progreso:{{getPercentage()}}%
          </span>

          <ion-button (click)="createItem()"  slot="end" mode="ios">
            <ion-icon  name="add-circle-outline"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-range [value]=" getPercentage()"  ></ion-range>

        
 <ion-reorder-group [disabled]="false" (ionReorderEnd)="handleReorderEnd($any($event))">
  @for (item of form.value.items; track item.name; let i = $index) {
    <ion-item lines="none" (click)="item.completed = !item.completed" style="cursor: pointer">
  <ion-checkbox slot="start" color="success" [(ngModel)]="item.completed" (click)="$event.stopPropagation()"></ion-checkbox>
  <ion-label class="ion-text-wrap">{{ item.name }}</ion-label>
  <ion-buttons slot="end">
    <ion-button (click)="removeItem(i); $event.stopPropagation()">
      <ion-icon name="trash-outline"></ion-icon>
    </ion-button>
  </ion-buttons>
  <ion-reorder slot="end"></ion-reorder>
</ion-item>
  }
</ion-reorder-group>

  <ion-button expand="block" (click)="submit()" [disabled]="form.invalid || form.value.items.length === 0" class="ion-margin">
  {{ task ? 'Actualizar' : 'Guardar' }}
</ion-button>
</ion-content>